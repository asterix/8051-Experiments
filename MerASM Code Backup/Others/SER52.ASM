;89c52 serial comm.
;14/3/2008
;ASTER

$NOMOD51
$INCLUDE (AT89X52.h)

ORG 0000H
SJMP 0030H

ORG 0030H




START:		MOV SCON,#40H
		ANL PCON,#7FH
		
		MOV IE,#90H
		MOV IP,#10H

		MOV T2CON,#30H
		MOV RCAP2H,#0FFH	;9600 bps
		MOV RCAP2L,#0D9H
		
		SETB TR2
		

		CLR A
		MOV DPTR,#MSG4		
		ACALL XMIT

HERE:		SJMP HERE



XMIT:		CLR A 
		MOVC A,@A+DPTR
		CJNE A,#0FFH,CONT
		MOV DPTR,#MSG4
		MOV A,#0DH
		MOV SBUF,A
		SJMP DONE
CONT:		MOV SBUF,A
		INC DPTR
DONE:		RET


ORG 0023H

LJMP 0900H

ORG 0900H
		
SER_INT:	NOP
		CLR TI
		NOP
		LCALL XMIT
		RETI


ORG 0F00H
	

MSG4: DB 'SERIAL COMM. CHECK'

END