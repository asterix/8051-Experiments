;ADC 0848 CHECK RUN CODE
;08/07/2008 :: 23:00 HRS		:::::::: LAST UPDATED : 09/07/2008
;ASTER

;PIN CONFIG:          	PORT 1 : DB0 ---- DB7 ADC
;			PORT 3 : OUTPUT LEDS
;			PORT 2 : CONTROL PINS ::::  P2.0- INTR(BAR) ; P2.1- WR(BAR) ; P2.2- CS(BAR) ; P2.3- RD(BAR)   ::::  

;PROGRAM RUN -SUCCESS ON ADC0848CCN






ORG 0000H
SJMP 0030H




ORG 0030H




START:		MOV P1,#00H
		MOV P2,#0AH
		MOV P3,#00H

		MOV P1,#08H	; SINGLE ENDED CHANNEL 1  :: 0000 1000
	
		ACALL WRITE	; START CONVERSION
	
	
;WAIT:		NOP
;		JB P2.0,WAIT
		
		ACALL READY	; CHECK IF CONVERSION IS DONE :: INTR BAR IS LOW
		
	

		ACALL READ	; READ DB0 TO DB7 AND PLACE IN R0
		
	

		MOV P3,R0	; OUTPUT DIGITAL CONVERSION
		
		ACALL DELAY

STOP:		SJMP START




WRITE:		SETB P2.3
		CLR P2.2	; CLEAR CS BAR
		SETB P2.1	; SET WR BAR
		NOP
		CLR P2.1	; CLEAR WR BAR
		NOP
		NOP
		NOP
		SETB P2.1	; RISING EDGE ON WR BAR
		RET



READY:		SETB P2.1
		CLR P2.2
		SETB P2.3

		SETB P3.7	; WATCH BITS
		SETB P3.6

WAIT:		JB P2.0,WAIT	; WAIT TILL INTR BAR IS LOW
		CLR P3.7
		CLR P3.6
		NOP
		RET


READ:		SETB P2.1
		CLR P2.2	; CS BAR LOW
		CLR P2.3	; RD BAR LOW
		NOP
		NOP
		MOV P1,#0FFH	;CONFIGURE PORT FOR INPUT::: DONT FORGET THIS
		MOV R0,P1
		NOP
		NOP
		RET				
		


DELAY:		MOV R7,#08H
		MOV R6,#0FFH
		MOV R5,#0FFH
		DJNZ R5,$
		DJNZ R6,$-2
		DJNZ R7,$-4	
		RET


END

	