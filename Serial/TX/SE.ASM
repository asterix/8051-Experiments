;89c52 serial comm.---- ONLY FOR ROUTINE USAGE ,NOT FOR RUN
;14/3/2008
;ASTER

$NOMOD51
$INCLUDE (89C52.MCU)


ORG 0000H
SJMP 0030H
ORG 0030H


START:		MOV SCON,#40H
		ANL PCON,#7FH
		
		MOV IE,#90H
		MOV IP,#10H
		
		MOV 32H,#30H
		MOV 31H,#30H
		MOV 30H,#30H

		MOV T2CON,#30H
		MOV RCAP2H,#0FFH	;9600 bps
		MOV RCAP2L,#0D9H
		
		SETB TR2
		
		
		MOV 55H,#32H
		LCALL XMIT

HERE:		SJMP HERE
;---------------------------------
;SERIAL TRANSMISSION CONTROL ROUTINE

XMIT:		PUSH ACC
		PUSH 00H

XMIT0:		CLR A
		MOV R0,55H
		CJNE R0,#2FH,CONTS
		MOV R0,#32H	
		MOV A,#0DH
		MOV SBUF,A
		SJMP TRIP

CONTS:		MOV A,@R0
		MOV SBUF,A
		DEC R0

TRIP:		MOV 55H,R0
		POP 00H
		POP ACC
		RET




ORG 0023H

LJMP 0900H

ORG 0900H
		
SER_INT:	NOP
		CLR TI
		NOP
		LCALL XMIT	
		NOP
		RETI




END