;89c52 serial comm.---- ONLY FOR ROUTINE USAGE NOT RUN
;14/3/2008
;ASTER

$NOMOD51
$INCLUDE (89C52.MCU)





START:		MOV SCON,#40H
		ANL PCON,#7FH
		
		MOV IE,#90H
		MOV IP,#10H

		MOV T2CON,#30H
		MOV RCAP2H,#0FFH	;9600 bps
		MOV RCAP2L,#0D9H
		
		SETB TR2
		
		SETB PSW.3
		MOV R0,#32H
		CLR PSW.3
		LCALL XMIT

DONE:		SJMP DONE
;---------------------------------
;SERIAL TRANSMISSION CONTROL ROUTINE

XMIT:		PUSH ACC
XMIT0:		CLR A
		SETB PSW.3
		MOV A,R0
		CJNE A,#2FH,CONTS
		MOV R0,#32H	
		MOV A,#0AH
		MOV SBUF,A
		SJMP TRIP
CONTS:		MOV A,@R0
		MOV SBUF,A
		DEC R0
TRIP:		CLR PSW.3
		POP ACC
		RET




ORG 0023H

LJMP 0900H

ORG 0900H
		
SER_INT:	NOP
		CLR TI
		NOP
		LCALL XMIT
		RETI




END