;MULTI LINE AND MULTI SCREEN CONTINUOUS THROUGH DISPLAY
;TESTED AND CHECKED ON AT89C51-     C51002/003
;09/08/2007
;PROGRAM RUN----------- SUCCESS.






ORG 0000H 				; P1.1-RS
SJMP 0030H				; P1.2-R/W
ORG 0030H 				; P1.3-EN




START:	CLR A 
	MOV P1,A
	MOV P2,A
	MOV P3,A
	
	MOV R3,A
	MOV R4,A


INIT:	MOV A,#38H
	LCALL COMMAND
	MOV A,#0CH
	LCALL COMMAND
	MOV A,#06H
	LCALL COMMAND
	MOV A,#01H
	LCALL COMMAND
	


	;MOV A,#'V'
	;LCALL DISPLAY
REWRT:	MOV R3,#00H
	MOV R4,#00H
	MOV R0,#00H
	MOV DPTR,#0F80H

				;CHAR BYTES FROM 0F80H
LOOP:	CLR A

	INC R3
	MOVC A,@A+DPTR
	INC DPTR
	LCALL DISPLAY
	LCALL DELAY
	INC R0
	CJNE R0,#20H,SIP1
	MOV R0,#00H
	LCALL CLEAR
SIP1:	CLR A
	MOVC A,@A+DPTR
	
	CJNE R3,#10H,SKIP
	MOV R3,#00H
	INC R4
	CJNE R4,#02H,NEXT
	MOV R4,#00H
	LCALL LINE1
	SJMP SKIP
NEXT:	LCALL LINE2
	
	
	
SKIP:	CJNE A,#0FFH,LOOP
	
	LCALL CLEAR
	SJMP REWRT


	
HERE:	SJMP HERE




COMMAND:LCALL READY
	CLR P1.2
	CLR P1.1
	MOV P2,A
	SETB P1.3
	NOP
	CLR P1.3
	RET


READY: 	SETB P2.7
	CLR P1.1
	SETB P1.2
BUSY:	CLR P1.3
	SETB P1.3
	JB P2.7,BUSY
	NOP 
	CLR P1.3
	RET


DISPLAY:LCALL READY
	CLR P1.2
	SETB P1.1
	MOV P2,A
	SETB P1.3
	NOP
	CLR P1.3
	RET

DELAY:  MOV R7,#01H
WAITC:	MOV R6,#0FFH
WAITB:	MOV R5,#0FFH
WAITA:	DJNZ R5,WAITA
	DJNZ R6,WAITB
	DJNZ R7,WAITC
	RET

CLEAR:	MOV A,#01H
	LCALL COMMAND
	RET

LINE1:	MOV A,#80H
	LCALL COMMAND
	RET

LINE2:	MOV A,#0C0H
	LCALL COMMAND
	RET




ORG 0F80H
		;DB 'hey mel !!!'
		;DB 'Be The Change You Want To See!'
		DB 'A GREAT MIND CAN SOAR HIGH IN IMAGINATION YET BE FIRMLY GROUNDED'
END